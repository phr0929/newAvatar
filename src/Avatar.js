import './main.css';

import reset from './resource/ic_cancel.svg'
import back from './resource/ic_back.svg'
import max from './resource/ic_max.svg'
import closed from './resource/closed.svg'
import thumbCat0 from './resource/thumbnail/cat/0.svg'
import thumbCat1 from './resource/thumbnail/cat/1.svg'
import thumbCat2 from './resource/thumbnail/cat/2.svg'

import thumbDress0 from './resource/thumbnail/dress/0.svg'
import thumbDress1 from './resource/thumbnail/dress/1.svg'
import thumbDress2 from './resource/thumbnail/dress/2.svg'
import thumbDress3 from './resource/thumbnail/dress/3.svg'
import thumbDress4 from './resource/thumbnail/dress/4.svg'
import thumbDress5 from './resource/thumbnail/dress/5.svg'
import thumbDress6 from './resource/thumbnail/dress/6.svg'
import thumbDress7 from './resource/thumbnail/dress/7.svg'
import thumbDress8 from './resource/thumbnail/dress/8.svg'
import thumbDress9 from './resource/thumbnail/dress/9.svg'
import thumbDress10 from './resource/thumbnail/dress/10.svg'
import thumbDress11 from './resource/thumbnail/dress/11.svg'
import thumbDress12 from './resource/thumbnail/dress/12.svg'
import thumbDress13 from './resource/thumbnail/dress/13.svg'
import thumbDress14 from './resource/thumbnail/dress/14.svg'
import thumbDress15 from './resource/thumbnail/dress/15.svg'
import thumbDress16 from './resource/thumbnail/dress/16.svg'

import thumbPants0 from './resource/thumbnail/pants/0.svg'
import thumbPants1 from './resource/thumbnail/pants/1.svg'
import thumbPants2 from './resource/thumbnail/pants/2.svg'
import thumbPants3 from './resource/thumbnail/pants/3.svg'
import thumbPants4 from './resource/thumbnail/pants/4.svg'
import thumbPants5 from './resource/thumbnail/pants/5.svg'
import thumbPants6 from './resource/thumbnail/pants/6.svg'
import thumbPants7 from './resource/thumbnail/pants/7.svg'
import thumbPants8 from './resource/thumbnail/pants/8.svg'
import thumbPants9 from './resource/thumbnail/pants/9.svg'
import thumbPants10 from './resource/thumbnail/pants/10.svg'
import thumbPants11 from './resource/thumbnail/pants/11.svg'
import thumbPants12 from './resource/thumbnail/pants/12.svg'
import thumbPants13 from './resource/thumbnail/pants/13.svg'
import thumbPants14 from './resource/thumbnail/pants/14.svg'
import thumbPants15 from './resource/thumbnail/pants/15.svg'
import thumbPants16 from './resource/thumbnail/pants/16.svg'
import thumbPants17 from './resource/thumbnail/pants/17.svg'
import thumbPants18 from './resource/thumbnail/pants/18.svg'

import thumbHand0 from './resource/thumbnail/hand/0.svg'
import thumbHand1 from './resource/thumbnail/hand/1.svg'
import thumbHand2 from './resource/thumbnail/hand/2.svg'
import thumbHand3 from './resource/thumbnail/hand/3.svg'
import thumbHand4 from './resource/thumbnail/hand/4.svg'
import thumbHand5 from './resource/thumbnail/hand/5.svg'
import thumbHand6 from './resource/thumbnail/hand/6.svg'
import thumbHand7 from './resource/thumbnail/hand/7.svg'
import thumbHand8 from './resource/thumbnail/hand/8.svg'
import thumbHand9 from './resource/thumbnail/hand/9.svg'

import thumbLayered0 from './resource/thumbnail/layered/0.svg'
import thumbLayered1 from './resource/thumbnail/layered/1.svg'
import thumbLayered2 from './resource/thumbnail/layered/2.svg'
import thumbLayered3 from './resource/thumbnail/layered/3.svg'
import thumbLayered4 from './resource/thumbnail/layered/4.svg'
import thumbLayered5 from './resource/thumbnail/layered/5.svg'
import thumbLayered6 from './resource/thumbnail/layered/6.svg'
import thumbLayered7 from './resource/thumbnail/layered/7.svg'
import thumbLayered8 from './resource/thumbnail/layered/8.svg'
import thumbLayered9 from './resource/thumbnail/layered/9.svg'
import thumbLayered10 from './resource/thumbnail/layered/10.svg'
import thumbLayered11 from './resource/thumbnail/layered/11.svg'
import thumbLayered12 from './resource/thumbnail/layered/12.svg'
import thumbLayered13 from './resource/thumbnail/layered/13.svg'
import thumbLayered14 from './resource/thumbnail/layered/14.svg'

import thumbHairitem0 from './resource/thumbnail/hairitem/0.svg'
import thumbHairitem1 from './resource/thumbnail/hairitem/1.svg'
import thumbHairitem2 from './resource/thumbnail/hairitem/2.svg'
import thumbHairitem3 from './resource/thumbnail/hairitem/3.svg'
import thumbHairitem4 from './resource/thumbnail/hairitem/4.svg'
import thumbHairitem5 from './resource/thumbnail/hairitem/5.svg'
import thumbHairitem6 from './resource/thumbnail/hairitem/6.svg'
import thumbHairitem7 from './resource/thumbnail/hairitem/7.svg'

import thumbBag0 from './resource/thumbnail/bag/0.svg'
import thumbBag1 from './resource/thumbnail/bag/1.svg'
import thumbBag2 from './resource/thumbnail/bag/2.svg'
import thumbBag3 from './resource/thumbnail/bag/3.svg'
import thumbBag4 from './resource/thumbnail/bag/4.svg'
import thumbBag5 from './resource/thumbnail/bag/5.svg'
import thumbBag6 from './resource/thumbnail/bag/6.svg'
import thumbBag7 from './resource/thumbnail/bag/7.svg'

import ctgrFaceOn from './resource/ctgr/faceOn.svg'
import ctgrFaceOff from './resource/ctgr/faceOff.svg'
import ctgrPetOn from './resource/ctgr/petOn.svg'
import ctgrPetOff from './resource/ctgr/petOff.svg'
import ctgrDressOn from './resource/ctgr/dressOn.svg'
import ctgrDressOff from './resource/ctgr/dressOff.svg'
import ctgrPantsOn from './resource/ctgr/pantsOn.svg'
import ctgrPantsOff from './resource/ctgr/pantsOff.svg'
import ctgrLayeredOn from './resource/ctgr/layereddressOn.svg'
import ctgrLayeredOff from './resource/ctgr/layereddressOff.svg'
import ctgrHairitemOn from './resource/ctgr/hairitemOn.svg'
import ctgrHairitemOff from './resource/ctgr/hairitemOff.svg'
import ctgrBagOn from './resource/ctgr/bagOn.svg'
import ctgrBagOff from './resource/ctgr/bagOff.svg'

import cat0 from './resource/item/cat/0.svg'
import cat1 from './resource/item/cat/1.svg'
import cat2 from './resource/item/cat/2.svg'

import dress0 from './resource/item/dress/0.svg'
import dress1 from './resource/item/dress/1.svg'
import dress2 from './resource/item/dress/2.svg'
import dress3 from './resource/item/dress/3.svg'
import dress4 from './resource/item/dress/4.svg'
import dress5 from './resource/item/dress/5.svg'
import dress6 from './resource/item/dress/6.svg'
import dress7 from './resource/item/dress/7.svg'
import dress8 from './resource/item/dress/8.svg'
import dress9 from './resource/item/dress/9.svg'
import dress10 from './resource/item/dress/10.svg'
import dress11 from './resource/item/dress/11.svg'
import dress12 from './resource/item/dress/12.svg'
import dress13 from './resource/item/dress/13.svg'
import dress14 from './resource/item/dress/14.svg'
import dress15 from './resource/item/dress/15.svg'
import dress16 from './resource/item/dress/16.svg'

import pants0 from './resource/item/pants/0.svg'
import pants1 from './resource/item/pants/1.svg'
import pants2 from './resource/item/pants/2.svg'
import pants3 from './resource/item/pants/3.svg'
import pants4 from './resource/item/pants/4.svg'
import pants5 from './resource/item/pants/5.svg'
import pants6 from './resource/item/pants/6.svg'
import pants7 from './resource/item/pants/7.svg'
import pants8 from './resource/item/pants/8.svg'
import pants9 from './resource/item/pants/9.svg'
import pants10 from './resource/item/pants/10.svg'
import pants11 from './resource/item/pants/11.svg'
import pants12 from './resource/item/pants/12.svg'
import pants13 from './resource/item/pants/13.svg'
import pants14 from './resource/item/pants/14.svg'
import pants15 from './resource/item/pants/15.svg'
import pants16 from './resource/item/pants/16.svg' 
import pants17 from './resource/item/pants/17.svg'
import pants18 from './resource/item/pants/18.svg' 

import hand0 from './resource/item/hand/0.svg'
import hand1 from './resource/item/hand/1.svg'
import hand2 from './resource/item/hand/2.svg'
import hand3 from './resource/item/hand/3.svg'
import hand4 from './resource/item/hand/4.svg'
import hand5 from './resource/item/hand/5.svg'
import hand6 from './resource/item/hand/6.svg'
import hand7 from './resource/item/hand/7.svg'
import hand8 from './resource/item/hand/8.svg'
import hand9 from './resource/item/hand/9.svg'

import layered0 from './resource/item/layered/0.svg'
import layered1 from './resource/item/layered/1.svg'
import layered2 from './resource/item/layered/2.svg'
import layered3 from './resource/item/layered/3.svg'
import layered4 from './resource/item/layered/4.svg'
import layered5 from './resource/item/layered/5.svg'
import layered6 from './resource/item/layered/6.svg'
import layered7 from './resource/item/layered/7.svg'
import layered8 from './resource/item/layered/8.svg'
import layered9 from './resource/item/layered/9.svg'
import layered10 from './resource/item/layered/10.svg'
import layered11 from './resource/item/layered/11.svg'
import layered12 from './resource/item/layered/12.svg'
import layered13 from './resource/item/layered/13.svg'
import layered14 from './resource/item/layered/14.svg'

import hairitem0 from './resource/item/hairitem/0.svg'
import hairitem1 from './resource/item/hairitem/1.svg'
import hairitem2 from './resource/item/hairitem/2.svg'
import hairitem3 from './resource/item/hairitem/3.svg'
import hairitem4 from './resource/item/hairitem/4.svg'
import hairitem5 from './resource/item/hairitem/5.svg'
import hairitem6 from './resource/item/hairitem/6.svg'
import hairitem7 from './resource/item/hairitem/7.svg'

import bag0 from './resource/item/bag/0.svg'
import bag1 from './resource/item/bag/1.svg'
import bag2 from './resource/item/bag/2.svg'
import bag3 from './resource/item/bag/3.svg'
import bag4 from './resource/item/bag/4.svg'
import bag5 from './resource/item/bag/5.svg'
import bag6 from './resource/item/bag/6.svg'
import bag7 from './resource/item/bag/7.svg'

import React, { useEffect, useState } from 'react';

const Avatar = (() => {

  const [ctgr,setCtgr] = useState(0) 
  const [initDialog,setInitDialog] = useState(false)
  const [backDialog,setBackDialog] = useState(false)
  const [fullDialog,setFullDialog] = useState(false)
  const [toast,setToast] = useState(false)
  const [itemList,setItemList] = useState([
    {ctgr:'cat',list:[cat0,cat1,cat2]},
    {ctgr:'dress',list:[dress0,dress1,dress2,dress3,dress4,dress5,dress6,dress7,dress8,dress9,dress10,dress11,dress12,dress13,dress14,dress15]},
    {ctgr:'pants',list:[pants0,pants1,pants2,pants3,pants4,pants5,pants6,pants7
    ,pants8,pants9,pants10,pants11,pants12,pants13,pants14,pants15,pants16,pants17,pants18]},
    {ctgr:'layered',list:[layered0,layered1,layered2,layered3,layered4,layered5,layered6
     ,layered7,layered8,layered9,layered10,layered11,layered12,layered13,layered14]},
    // {ctgr:'hairitem',list:[hairitem0,hairitem1,hairitem2,hairitem3,hairitem4,hairitem5,hairitem6]},
    {ctgr:'bag',list:[bag0,bag1,bag2,bag3,bag4,bag7]},
    {ctgr:'hand',list:[hand0,hand1,hand2,hand3,hand4,hand5,hand8,hand9]}  
  ])

  const [myAvatar,setMyAvatar] = useState([])

  const handleCkItem = (ctgr,item) => {

    for(let i = 0; i < myAvatar.length; i++){
      myAvatar[ctgr]=item
    }

    setItemList([...itemList])

  }

  useEffect(()=>{
    if(!toast) return;

    const timerId = setTimeout(() => {
        handleClosed()
      }, 3000);
    
      return () => clearTimeout(timerId);

  },[toast])

  const handleClosed = (event, reason) => {

    if (reason === 'clickaway') {
        return;
    }

    setToast(false)
  }

  const thumbList = [
    [thumbCat0,thumbCat1,thumbCat2],
    [thumbDress0,thumbDress1,thumbDress2,thumbDress3,thumbDress4
    ,thumbDress5,thumbDress6,thumbDress7,thumbDress8,thumbDress9
    ,thumbDress10,thumbDress11,thumbDress12,thumbDress13,thumbDress14,thumbDress15],
    [thumbPants0,thumbPants1,thumbPants2,thumbPants3,thumbPants4,thumbPants5,thumbPants6,thumbPants7
    ,thumbPants8,thumbPants9,thumbPants10,thumbPants11,thumbPants12,thumbPants13,thumbPants14,thumbPants15,thumbPants16,thumbPants17,thumbPants18],
    [thumbLayered0,thumbLayered1,thumbLayered2,thumbLayered3,thumbLayered4,thumbLayered5,thumbLayered6,thumbLayered7,thumbLayered8
    ,thumbLayered9,thumbLayered10,thumbLayered11,thumbLayered12,thumbLayered13,thumbLayered14],
    // [thumbHairitem0,thumbHairitem1,thumbHairitem2,thumbHairitem3,thumbHairitem4,thumbHairitem5,thumbHairitem6], 
    [thumbBag0,thumbBag1,thumbBag2,thumbBag3,thumbBag4,thumbBag7],
    [thumbHand0,thumbHand1,thumbHand2,thumbHand3,thumbHand4,thumbHand5,thumbHand8,thumbHand9]
  ]
 
  useEffect(()=>{
    const handleSetInit = ()=>{   
      let initList = [0,0,0,0,0,0]
      window.localStorage.setItem("myAvatarList",JSON.stringify(initList))
      return JSON.stringify([])
    }

    let it = JSON.parse(window.localStorage.getItem("myAvatarList")??handleSetInit());
     
    setMyAvatar(it)
    return(()=>{
      window.onpopstate = {}
    })
  },[])

  useEffect(()=>{
    if(fullDialog){
        window.history.pushState({ page: 1 }, "title 1", "?page=1")
    }
    window.onpopstate = handleOnBack
  },[fullDialog])
  const handleOnBack = ()=>{
    setFullDialog(false)
  }


  const handleSave = () => {
    let item = [...myAvatar]  
    window.localStorage.setItem("myAvatarList",JSON.stringify(item));
    setMyAvatar(item) 

    setToast(true)
  }
  const handleInit = () => {
    let item = [0,0,0,0,0,0]   
    setMyAvatar(item) 
  }
  const handleBack = () => {  
    let it = JSON.parse(window.localStorage.getItem("myAvatarList"));
    setMyAvatar(it) 
  }

  

  return (
    <div className="mainLayout">
      <div className='avatarLayout'>
        <div className='avatarButtonTop'>
          <div onClick={()=>handleSave()}>저장</div>
          {/* <img src={save} alt='' onClick={()=>handleSave()}/> */}
        </div>
        
        <div className='avatarButtonBottom'> 
          <div onClick={()=>setBackDialog(true)}>
            <img src={back} alt='' />
          </div>
          <div onClick={()=>setInitDialog(true)}>
            <img src={reset} alt='' />
          </div>
        </div>
        
        <div className='avatarButtonBottom2'> 
          <img src={max} alt='' onClick={()=>setFullDialog(true)}/>
        </div>
        
        {itemList.map((val,idx)=>
          <img key={idx} className={`${val.ctgr} avatarimg`} src={val.list[myAvatar[idx]]} alt=''/>
        )}
      </div>

      <div className='ctgrLayout'>
        <img onClick={()=>{setCtgr(0);}} className={ctgr===0?'ctgrOn':'ctgrOff'} 
             src={ctgr===0?ctgrFaceOn:ctgrFaceOff} alt=''/>      
        <img onClick={()=>{setCtgr(1);}} className={ctgr===1?'ctgrOn':'ctgrOff'} 
             src={ctgr===1?ctgrDressOn:ctgrDressOff} alt=''/>        
        <img onClick={()=>setCtgr(2)} className={ctgr===2?'ctgrOn':'ctgrOff'} 
             src={ctgr===2?ctgrPantsOn:ctgrPantsOff} alt=''/>
        <img onClick={()=>setCtgr(3)} className={ctgr===3?'ctgrOn':'ctgrOff'} 
             src={ctgr===3?ctgrLayeredOn:ctgrLayeredOff} alt=''/>
        {/* <img onClick={()=>setCtgr(4)} className={ctgr===4?'ctgrOn':'ctgrOff'} 
             src={ctgr===4?ctgrHairitemOn:ctgrHairitemOff} alt=''/> */}
        <img onClick={()=>setCtgr(4)} className={ctgr===4?'ctgrOn':'ctgrOff'} 
             src={ctgr===4?ctgrBagOn:ctgrBagOff} alt=''/>
        <img onClick={()=>setCtgr(5)} className={ctgr===5?'ctgrOn':'ctgrOff'} 
             src={ctgr===5?ctgrPetOn:ctgrPetOff} alt=''/>
      </div>

      <div className='itemLayout'> 
        {thumbList[ctgr].map((val,idx)=>
          <div key={idx}>
            <img src={val} onClick={()=>handleCkItem(ctgr,idx)} 
            className={myAvatar[ctgr]===idx?'avatar-selected-on':'avatar-selected-off'} alt=''/>
          </div>
        )}
      </div>

      <div style={{display:backDialog?'flex':'none'}} className='dialog' onClick={()=>setBackDialog(false)}>
        <div className='dialogButtonList'>
          <div onClick={()=>handleBack()}>이전 코디로 돌아가기</div> 
          <div onClick={()=>setBackDialog(false)}>코디 계속하기</div>
        </div>
      </div>

      
      <div style={{display:initDialog?'flex':'none'}} className='dialog' onClick={()=>setInitDialog(false)}>
        <div className='dialogButtonList'>
          <div onClick={()=>handleInit()}>코디 초기화 하기</div>
          <div onClick={()=>setInitDialog(false)}>코디 계속하기</div>
        </div>
      </div>


      <div style={{display:toast?'flex':'none'}} className='toast' onClick={()=>setToast(false)}>
        <div className='toastBox'>
         코디가 저장되었습니다
        </div>
      </div>


      <div style={{display:fullDialog?'flex':'none'}} className='fullDialog'>
        <img className='dialogClosed' src={closed} alt=''  onClick={()=>setFullDialog(false)}/>
        <div className='fullAvatar'>
        {itemList.map((val,idx)=>
          <img key={idx} className={`${val.ctgr} fullAvatarimg`} src={val.list[myAvatar[idx]]} alt=''/>
        )}
        </div>
      </div>

    </div>
  );
})

export default Avatar;
